<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sockets Server</title>
    <style>
      body {
        position: absolute;
      }
    </style>
  </head>
  <body>
    <p>Hallo</p>
  </body>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    let socket;
    let currentSocketId = [];
    let $cursor;
    let targetSocketId;

    const init = () => {
      targetSocketId = getUrlParameter('targetSocketId');
      console.log(targetSocketId)
      console.log(targetSocketId);
      socket = io.connect("/");
      socket.on("connect", () => {
        console.log(`Connected: ${socket.id}`);
      });

      window.addEventListener(`mousemove`, (e) => handleMouseMove(e));
      window.addEventListener(`touchmove`, (e) => handleTouchMove(e));
    };

    // getUrlParameters
    const getUrlParameter = (name) => {
      name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
      const regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
      const results = regex.exec(location.search);
      return results === null
        ? false
        : decodeURIComponent(results[1].replace(/\+/g, " "));
    };

    // HandleMouseMove
    const handleMouseMove = (e) => {
      if (socket.connected) {
        socket.emit(`update`, targetSocketId, {
          x: e.clientX / window.innerWidth,
          y: e.clientY / window.innerHeight,
        });
      }
    };

    // HandleTouchMove
    const handleTouchMove = (e) => {
      if (socket.connected) {
        socket.emit(`update`, targetSocketId, {
          x: e.touches[0].clientX / window.innerWidth,
          y: e.touches[0].clientY / window.innerHeight,
        });
      }
    };

    init();
  </script>
</html>
