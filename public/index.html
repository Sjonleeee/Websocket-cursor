<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sockets Server</title>
    <style>
      body {
        position: absolute;
      }

      .cursor {
        position: absolute; /* or fixed */
        top: 0;
        left: 0;
        width: 50px;
        height: 50px;
        background-color: red;
        border-radius: 50%;
        transition: all 0.05s;
      }
    </style>
  </head>
  <body>
    <p><a href="#" id="remoteUrl">Open remote controller</a></p>
  </body>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const $remoteUrl = document.getElementById("remoteUrl");

    let socket;
    let currentSocketId = [];
    let $cursor;

    const init = () => {
      $cursor = document.querySelector(`#cursor`);
      if (!$cursor) {
        $cursor = document.createElement("div");
        $cursor.classList.add("cursor");
        $cursor.setAttribute("id", `cursor`);
        document.body.appendChild($cursor);
      }

      socket = io.connect("/");
      socket.on("connect", () => {
        console.log(`Connected: ${socket.id}`);
        $remoteUrl.textContent = socket.id;
        $remoteUrl.setAttribute(
          "href",
          `./remote.html?targetSocketId=${socket.id}`
        );
      });

      socket.on(`update`, (senderId, data) => {
        $cursor.style.left = `${data.x * window.innerWidth}px`;
        $cursor.style.top = `${data.x * window.innerHeight}px`;
      });
      window.addEventListener("mousemove", (event) => handlesMouseMove(e));
    };

      const handleMouseMove = (e) => {
        if (socket.connected) {
          socket.emit(`update`, {
            x: e.clientX / window.innerWidth,
            y: e.clientY / window.innerHeight,
          });
        }
    };

    window.addEventListener("mousemove", (event) => {
      // Mousemove event
      socket.emit("update", {
        x: event.clientX / window.innerWidth,
        y: event.clientY / window.innerHeight,
      });
    });

    // Touch move event
    window.addEventListener("touchmove", (event) => {
      console.log(event.touches[0]);
      socket.emit("update", {
        x: event.touches[0].clientX / window.innerWidth,
        y: event.touches[0].clientY / window.innerHeight,
      });
    });

    init();
  </script>
</html>
